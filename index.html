<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Proctor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="styles/style.css">
  
  <style>
    #bg-video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover; /* Ensures video covers screen without stretching */
      z-index: -1; /* Puts video behind everything */
    }
    /* Ensure header and main content sit above the video */
    body {
      background: transparent !important;
    }

    #startCard {
    /* 0.85 means 85% opacity. Lower this number (e.g., 0.7) for more transparency */
    background: rgba(30, 41, 59, 0.60) !important; 
    
    /* This blurs the video slightly behind the card so text is easier to read */
    backdrop-filter: blur(8px); 
    -webkit-backdrop-filter: blur(8px); /* For Safari support */
    
    /* Optional: Make the border slightly transparent too */
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
  }
  </style>
</head>
<body>
  
  <video autoplay muted loop playsinline id="bg-video">
  <source src="Furina.mp4" type="video/mp4">
  Your browser does not support HTML5 video.
  </video>

  <button id="musicToggle" class="btn btn-dark rounded-circle" onclick="toggleAudio()" 
  style="position: fixed; bottom: 20px; right: 20px; z-index: 1000; width: 50px; height: 50px; 
  display: flex; align-items: center; justify-content: center; 
  box-shadow: 0 4px 12px rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.2);">
  <i class="bi bi-volume-mute-fill" id="musicIcon" style="font-size: 1.5rem;"></i>
  </button>

  <header class="header-bg">
    <h1><i class="bi bi-shield-check me-2"></i>Proctool</h1>
    <h2>Designed to secure online exams</h2>
  </header>

  <main class="container py-5">
    <div class="card card-custom mx-auto" id="startCard">
      <div class="card-body">
        <h5 class="card-title">Start Your Exam</h5>
        <p class="text-center text-secondary" style="margin-bottom: 2rem; font-size: 0.95rem;">
          Enter your details below to begin the assessment. Make sure you have a stable internet connection and use a compatible browser.
        </p>

        <form id="userForm">
          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="lastName" placeholder="Last Name" required autocomplete="off">
            <label for="lastName"><i class="bi bi-person me-2"></i>Full Name (Last, First)</label>
          </div>

          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="firstName" placeholder="Section" required autocomplete="off">
            <label for="firstName"><i class="bi bi-layers me-2"></i>Section/Class Number</label>
          </div>

          <div class="form-floating mb-4">
            <input type="text" class="form-control" id="code" placeholder="Test Code" required autocomplete="off">
            <label for="code"><i class="bi bi-key me-2"></i>Test Code (from your instructor)</label>
          </div>

          <div class="alert alert-info d-flex align-items-start" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2);">
            <i class="bi bi-info-circle me-2" style="color: var(--accent); margin-top: 0.25rem;"></i>
            <div>
              <strong>System Requirements:</strong>
              <ul style="margin: 0.5rem 0 0 0; padding-left: 1.25rem; font-size: 0.9rem;">
                <li>Modern browser (Chrome, Firefox, Safari, Edge)</li>
                <li>Stable internet connection</li>
              </ul>
            </div>
          </div>
        </form>

        <button class="btn btn-accent btn-lg" id="startBtn" style="width: 100%; margin-top: 1rem;">
          <i class="bi bi-play-fill me-2"></i>BEGIN EXAM
        </button>

        <div class="loading-spinner" id="startLoadingSpinner">
          <div class="loader" aria-hidden="true"></div>
          <p class="mt-3">Initializing exam environment...</p>
        </div>
      </div>
    </div>

    <div style="margin-top: 3rem; padding: 0 1rem; max-width: 700px; margin-left: auto; margin-right: auto;">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
        <div style="position: fixed top;text-align: center; padding: 1rem; border-radius: 8px; background: var(--secondary); border: 1px solid var(--border);">
          <i class="bi bi-shield-exclamation" style="font-size: 1.5rem; color: var(--accent); display: block; margin-bottom: 0.5rem;"></i>
          <h6 style="margin-bottom: 0.5rem;">Anti-Cheat Monitoring</h6>
          <p style="font-size: 0.85rem; color: var(--text-muted); margin: 0;">Screen, browser, and activity monitoring active</p>
        </div>
        <div style="text-align: center; padding: 1rem; border-radius: 8px; background: var(--secondary); border: 1px solid var(--border);">
          <i class="bi bi-clock-history" style="font-size: 1.5rem; color: var(--accent); display: block; margin-bottom: 0.5rem;"></i>
          <h6 style="margin-bottom: 0.5rem;">Timed Assessment</h6>
          <p style="font-size: 0.85rem; color: var(--text-muted); margin: 0;">Real-time timer with automatic submission</p>
        </div>
      </div>
    </div>
  </main>

  <div class="modal fade" id="instructionModal" tabindex="-1" aria-labelledby="instructionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="instructionModalLabel">
            <i class="bi bi-info-circle me-2"></i>Monitored Exam Instructions
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body modal-body-custom">
          <div id="instructionsText" style="margin-bottom: 1.5rem; line-height: 1.8;">Loading instructions...</div>
          
          <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1.5rem;">
            <h6 style="color: var(--danger); margin-bottom: 0.75rem; display: flex; align-items: center;">
              <i class="bi bi-shield-exclamation me-2"></i>Security & Conduct Policy
            </h6>
            <ul style="margin: 0; padding-left: 1.25rem; font-size: 0.9rem; color: var(--text-secondary);">
              <li>No tab switching or window minimizing during the exam</li>
              <li>No screenshots, screen recording, or external devices</li>
              <li>No copying, pasting, or external resources</li>
              <li>Avoid resizing your browser window</li>
              <li>Use Skip button when needed</li>
              <li>Automatically submit when a certain violation count is reached</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancelStart" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-accent" id="agreeBtn">I Understand - Start Exam</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="noInternetModal" tabindex="-1" aria-labelledby="noInternetLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="noInternetLabel">
            <i class="bi bi-wifi-off me-2"></i>Connection Required
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center modal-body-custom">
          <p id="noInternetText">No stable internet connection detected. Please check your connection and try again.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-accent" id="retryOnline">Retry Connection</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    Proverbs 16:28 A fraudulent man sows strife: and a whisperer separates chief friends.
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <div class="modal fade" id="warningModal" tabindex="-1" aria-labelledby="warningModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="warningModalLabel">
            <i class="bi bi-exclamation-triangle-fill me-2" style="color: var(--warning);"></i>Security Warning
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center modal-body-custom">
          <div class="warn-text mb-3">Suspicious activity detected</div>
          <p id="warningText">Do not switch tabs, minimize the window, or use external devices during the exam. Multiple violations will result in disqualification.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-accent" id="continueBtn">Continue Exam</button>
          <button type="button" class="btn btn-secondary" id="exitBtn" data-bs-dismiss="modal">Exit Exam</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="confirmModalLabel">Confirm Submission</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center modal-body-custom">
          <p id="confirmText">Are you sure you want to submit this answer? You cannot change it after submission.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="confirmNo" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-accent" id="confirmYes">Submit Answer</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="duplicateModal" tabindex="-1" aria-labelledby="duplicateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="duplicateModalLabel">
            <i class="bi bi-exclamation-circle-fill me-2" style="color: var(--danger);"></i>Duplicate Entry
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center modal-body-custom">
          <p id="duplicateText">An exam session with this user is already in progress. Please contact your instructor if this is an error.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="duplicateOk" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="errorModalLabel">
            <i class="bi bi-exclamation-diamond-fill me-2" style="color: var(--danger);"></i>Error
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body modal-body-custom">
          <div id="errorText" class="alert alert-danger" style="margin: 0; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3);">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="errorOk" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  
  <script src="scripts/login.js"></script>
 <script>
  function toggleAudio() {
    var video = document.getElementById("bg-video");
    var icon = document.getElementById("musicIcon");
    var btn = document.getElementById("musicToggle");

    if (!video) return;

    if (video.muted) {
      // 1. UNMUTE & FORCE VOLUME
      video.muted = false;
      video.volume = 1.0; 
      
      // 2. VISUAL UPDATES
      icon.classList.remove("bi-volume-mute-fill");
      icon.classList.add("bi-volume-up-fill");
      btn.classList.remove("btn-dark");
      btn.classList.add("btn-accent");

      // 3. FORCE PLAY (Sometimes helps wake up audio)
      var playPromise = video.play();
      if (playPromise !== undefined) {
        playPromise.then(_ => {
          console.log("Audio started");
        })
        .catch(error => {
          console.log("Playback prevented:", error);
        });
      }
    } else {
      // MUTE
      video.muted = true;
      icon.classList.remove("bi-volume-up-fill");
      icon.classList.add("bi-volume-mute-fill");
      btn.classList.remove("btn-accent");
      btn.classList.add("btn-dark");
    }
  }
</script>
  <script>
    // Global API endpoint for this deployment (set from new Apps Script deploy ID)
    // Placed before runtime scripts so they pick up the correct URL immediately.
    window.ANSWER_API_URL = 'https://script.google.com/macros/s/AKfycby6B9OgDmMNJqGmDNBvF7MJnAaV1wXTnvmzjjCEqn8vIh1zEFx7Izn3jxEJIsvnuXF4/exec';
  </script>
</body>
</html>
